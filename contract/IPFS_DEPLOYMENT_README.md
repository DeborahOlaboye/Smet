# NFT Metadata IPFS Deployment Guide\n\n## Overview\n\nThis guide explains how to deploy NFT metadata to IPFS for the Smet Gaming Ecosystem. The metadata follows ERC-721 and ERC-1155 standards and is uploaded to IPFS using Pinata.\n\n## Prerequisites\n\n1. **Pinata Account**: Sign up at [pinata.cloud](https://pinata.cloud)\n2. **API Keys**: Generate JWT token and gateway URL from Pinata dashboard\n3. **Environment Setup**: Configure environment variables\n\n## Setup\n\n### 1. Install Dependencies\n```bash\ncd contract\nnpm install\n```\n\n### 2. Configure Environment\nCopy `.env.example` to `.env` and fill in your Pinata credentials:\n```bash\ncp .env.example .env\n```\n\nEdit `.env`:\n```\nPINATA_JWT=your_pinata_jwt_token_here\nPINATA_GATEWAY=your_pinata_gateway_url_here\n```\n\n## Metadata Structure\n\n### Heroes (ERC-721)\nLocation: `metadata/heroes/`\n- Individual JSON files for each hero (1.json, 2.json, etc.)\n- Follows ERC-721 metadata standard\n\n### Loot Items (ERC-1155)\nLocation: `metadata/loot/`\n- Individual JSON files for each loot item (1.json, 2.json, etc.)\n- Follows ERC-1155 metadata standard\n\n### Metadata Schema\n```json\n{\n  \"name\": \"Token Name\",\n  \"description\": \"Token Description\",\n  \"image\": \"ipfs://QmHash/image.png\",\n  \"external_url\": \"https://smet-gaming.com/token/1\",\n  \"attributes\": [\n    {\n      \"trait_type\": \"Rarity\",\n      \"value\": \"Legendary\"\n    }\n  ],\n  \"background_color\": \"1a1a2e\"\n}\n```\n\n## Deployment Process\n\n### Option 1: Complete Deployment (Recommended)\n```bash\nnpm run ipfs:deploy\n```\nThis runs the complete deployment pipeline:\n1. Validates all metadata\n2. Uploads to IPFS\n3. Updates contract URIs\n4. Generates deployment report\n\n### Option 2: Step-by-Step Deployment\n\n#### Step 1: Validate Metadata\n```bash\nnpm run ipfs:validate\n```\nValidates all metadata files for ERC standard compliance.\n\n#### Step 2: Upload to IPFS\n```bash\nnpm run ipfs:upload\n```\nUploads all metadata files to IPFS via Pinata.\n\n#### Step 3: Update Contract URIs\n```bash\nnpm run ipfs:update-uris\n```\nUpdates deployed contracts with IPFS base URIs.\n\n## Contract Integration\n\n### SmetHero (ERC-721)\n- Constructor accepts `baseURI` parameter\n- `setBaseURI()` function for updates\n- `tokenURI()` returns `baseURI + tokenId + \".json\"`\n\n### SmetLoot (ERC-1155)\n- Constructor accepts `baseURI` parameter\n- `setBaseURI()` function for updates\n- `uri()` returns `baseURI + tokenId + \".json\"`\n\n## Output Files\n\n### `ipfs-metadata-results.json`\nContains IPFS hashes and URIs for all uploaded metadata:\n```json\n{\n  \"heroes\": {\n    \"1\": {\n      \"ipfsHash\": \"QmHash1\",\n      \"uri\": \"ipfs://QmHash1\",\n      \"gatewayUrl\": \"https://gateway.pinata.cloud/ipfs/QmHash1\"\n    }\n  },\n  \"loot\": {\n    \"1\": {\n      \"ipfsHash\": \"QmHash2\",\n      \"uri\": \"ipfs://QmHash2\",\n      \"gatewayUrl\": \"https://gateway.pinata.cloud/ipfs/QmHash2\"\n    }\n  }\n}\n```\n\n### `nft-config.json`\nContains contract addresses and IPFS configuration:\n```json\n{\n  \"contracts\": {\n    \"smetHero\": {\n      \"address\": \"0x...\",\n      \"baseURI\": \"ipfs://QmHeroFolder/\"\n    },\n    \"smetLoot\": {\n      \"address\": \"0x...\",\n      \"baseURI\": \"ipfs://QmLootFolder/\"\n    }\n  },\n  \"updatedAt\": \"2024-01-01T00:00:00.000Z\"\n}\n```\n\n### `ipfs-deployment-report.json`\nComprehensive deployment report with summary statistics.\n\n## Verification\n\n### Test Metadata URLs\nAfter deployment, test the metadata URLs:\n```\n# Hero #1\nhttps://gateway.pinata.cloud/ipfs/QmHash1\n\n# Loot #1\nhttps://gateway.pinata.cloud/ipfs/QmHash2\n```\n\n### Contract Verification\nVerify contract URIs are updated:\n```solidity\n// SmetHero\nstring memory heroURI = smetHero.tokenURI(1);\n// Should return: \"ipfs://QmHeroFolder/1.json\"\n\n// SmetLoot\nstring memory lootURI = smetLoot.uri(1);\n// Should return: \"ipfs://QmLootFolder/1.json\"\n```\n\n## Troubleshooting\n\n### Common Issues\n\n1. **Pinata Authentication Error**\n   - Verify JWT token is correct\n   - Check token permissions in Pinata dashboard\n\n2. **Metadata Validation Errors**\n   - Run `npm run ipfs:validate` to see specific errors\n   - Fix JSON syntax and required fields\n\n3. **Contract Update Errors**\n   - Ensure contracts are deployed\n   - Verify you have owner permissions\n   - Check network configuration\n\n4. **IPFS Gateway Issues**\n   - Try different IPFS gateways\n   - Wait for propagation (can take a few minutes)\n\n### Debug Commands\n```bash\n# Check metadata validation\nnpm run ipfs:validate\n\n# Test individual upload\nnode scripts/ipfs/upload-metadata.js\n\n# Check contract addresses\ncat ignition/deployments/sepolia-deployment/deployed_addresses.json\n```\n\n## Best Practices\n\n1. **Always validate metadata before upload**\n2. **Keep backup of IPFS hashes**\n3. **Test on testnet first**\n4. **Use descriptive names and descriptions**\n5. **Optimize image sizes for faster loading**\n6. **Include all required ERC standard fields**\n\n## Security Considerations\n\n1. **Never commit `.env` file**\n2. **Use environment variables for sensitive data**\n3. **Verify IPFS hashes after upload**\n4. **Test metadata URLs before contract deployment**\n5. **Keep Pinata API keys secure**\n\n## Support\n\nFor issues or questions:\n1. Check the troubleshooting section\n2. Review deployment logs\n3. Verify Pinata dashboard for upload status\n4. Test metadata URLs manually